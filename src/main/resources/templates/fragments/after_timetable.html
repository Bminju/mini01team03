<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="fragment-timetable" class="timetable">
  <html>
	<style>
  body {
    margin: 40px 10px;
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
  }
  #calendar {
    max-width: 1100px;
    margin: 10 auto;
  }
  .fc-event {
    margin:3px;
    cursor: move;
  }
  #external-events{
    float: left; width:15%; margin-top:50px; padding-right:10px;
  }

</style>
    
    <script>

      var calendar = null; //calender변수를 전역으로 쓰기 위함.

		$(document).ready(function(){ //제이쿼리 방식
      //document.addEventListener('DOMContentLoaded', function() { //순수자바스크립트 방식
        var Calendar = FullCalendar.Calendar;
        var Draggable = FullCalendar.Draggable;
        
        var containerEl = document.getElementById('external-events');
        var calendarEl = document.getElementById('calendar');
        var checkbox = document.getElementById('drop-remove');
       
        var all_events = null;
        all_events = loadingEvents();

       new Draggable(containerEl, {
        itemSelector: '.fc-event',
        eventData: function(eventEl) {
          return {
            title: eventEl.innerText
        };
      }
    });
       
          calendar = new Calendar(calendarEl, { //var를 제거하여 전역변수로 할당한다.
		      initialDate: '2021-07-01',	
		      initialView: 'timeGridWeek',  //시간,주별 일정 그리드
		      headerToolbar: {
			    left: 'prev,next today',
			    center: 'title',
			    right:  'dayGridMonth,timeGridWeek,timeGridDay' 
		            },
		      height:'auto',
		      navLinks: true,
		      editable: true,  //수정가능 여부
     	    selectable: true,
      	  selectMirror: true,
          nowIndicator: true,
          droppable: true,
          events: all_events,
          drop: function(info) {  //drop을 수행할 때 이루어지는 fuction
          if (checkbox.checked) {  //드래그를 하면 드래그박스에서 삭제 됨
          info.draggedEl.parentNode.removeChild(info.draggedEl);
              }
           }
          });
        calendar.render(); 
      });
 
      function loadingEvents() {
          var return_value = null;
          $.ajax({
			  url:'getAddress',
			  type:'post',
			  dataType:'json',
			  contentType:'application/json; charset=UTF-8',
			  data: {},
			  success: function(data){
				 console.log(data); //object
				return_value = JSON.stringify(data); //json형태로 변환
				console.log(return_value);
			  },
			  error: function(e){
			  	console.log(e);
			}
		
        });
        return return_value;
		}
	
    </script>
<body>
 <div id="external-events" >
    <p>    
  <strong>드래그하여서 일정표에 추가해보세요 !</strong>
    </p>
   <!--이제 여기다가 for문을 돌려서 마커의 갯수만큼 생성할꺼야....어카지? 타임리프? or 자바스크립트?ㅎㅎㅎ 답은 자바스크립트였다 !-->
    <!--<div class="fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event">
       <div th:each ="obj: ${id='result'}"}> </div>
    </div>-->
   <script>
   // function listadd (result) {
     // for(var i; i < result.length; i++) {
    //    var list = document.createElement('div');
    //    var listid = document.createAttribute('id=result');
    //    list.appendChild(listid);
     //   documnet.body.appendChild(list);
     // }
   // }
   </script>
   <div id = "divlist">
    <div id = "divlist" class="fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event">
      <div id="result" class="fc-event-main"></div></div>
    </div>

    <div id="newlist"></div>


   <!--<div class="fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event">
      <div id="result" class="fc-event-main">My Event 1</div>
    </div>

    <div class="fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event">
      <div id="result" class="fc-event-main">My Event 2</div>
    </div>
    <div class="fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event">
      <div class="fc-event-main">My Event 3</div>
    </div>
    <div class="fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event">
      <div class="fc-event-main">My Event 4</div>
    </div>
    <div class="fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event">
      <div class="fc-event-main">My Event 5</div>
    </div>
  -->
    <p>
      <input type="checkbox" id="drop-remove" checked/>
      <label for="drop-remove">remove after drop</label>
    </p>
  </div>

  <!--<div id="calendar-container">
    <div id="calendar"></div>
  </div> -->
  <div>
    <button onclick="fn_submit()">일정확정 !</button>
  </div>
 
  <div id="calendar-container" style="float: left; width:80%;" >
	<div id="calendar"></div>
  </div>
  </body>
</html>